<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>성공 페이지</title>
  <style>
    body{font-family:sans-serif;margin:0;padding:0;text-align:center;background:#f9f9f9;}
    h2{padding:20px 0;}
    .btn{display:block;margin:10px auto;padding:12px 20px;font-size:16px;
         border:none;border-radius:6px;cursor:pointer;}
    .write{background:#00bfff;color:#fff;}
    .view{background:#ffcc00;}
    .logout{background:#ccc;}
    #feed{background:#ffdddd;padding:30px;margin-top:20px;min-height:300px;}
    .item-btn{display:block;margin:8px auto;padding:8px 14px;border:1px solid #aaa;
              border-radius:6px;background:#fff;cursor:pointer;}
  </style>
</head>
<body>
  <h2>성공! 환영합니다.</h2>
  <button class="btn write" onclick="location.href='write.html?user='+user">소설 쓰기</button>
  <button class="btn view" onclick="location.href='view.html?user='+user">내 소설 보기</button>
  <button class="btn logout" onclick="location.href='index.html'">로그아웃</button>

  <h3>공개 피드</h3>
  <div id="feed"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
    import { getFirestore, collection, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

    const params = new URLSearchParams(location.search);
    const user = params.get("user") || "익명";

    const firebaseConfig = {
      apiKey: "AIzaSyCr516GzQlQu6ev5K9GKwlE--6GWjPSjKw",
      authDomain: "novel-app-33aa7.firebaseapp.com",
      projectId: "novel-app-33aa7",
      storageBucket: "novel-app-33aa7.firebasestorage.app",
      messagingSenderId: "791233454587",
      appId: "1:791233454587:web:20319c91ca14d34bdc6b5e",
      measurementId: "G-BXT8Y97XW2"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const feedEl=document.getElementById("feed");
    const q=query(collection(db,"public_novels"),orderBy("createdAt","desc"));
    onSnapshot(q,snap=>{
      feedEl.innerHTML="";
      snap.forEach(doc=>{
        const v=doc.data();
        const btn=document.createElement("button");
        btn.className="item-btn";
        btn.textContent=(v.title||"(제목없음)")+" - "+(v.author||"익명");
        btn.onclick=()=>{location.href="detail.html?id="+doc.id;};
        feedEl.appendChild(btn);
      });
    });
  </script>
</body>
</html>

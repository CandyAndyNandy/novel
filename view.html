<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>내 소설 보기</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
    }
    .top-bar {
      display: flex;
      height: 20vh;
    }
    .red-section {
      flex: 2;
      background-color: red;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: flex-start;
      padding: 10px;
      color: white;
    }
    .yellow-section {
      flex: 8;
      background-color: yellow;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 32px;
      font-weight: bold;
    }
    .button-bar {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }
    .button-bar button {
      background: white;
      color: black;
      border: 1px solid black;
      padding: 8px 12px;
      cursor: pointer;
      font-size: 14px;
    }
    .button-bar button:hover {
      background: #f2f2f2;
    }
    .content {
      padding: 20px;
    }
    .novel-button {
      display: block;
      width: 100%;
      margin: 5px 0;
      padding: 10px;
      border: 1px solid #333;
      background: white;
      cursor: pointer;
      text-align: left;
    }
    .novel-button:hover {
      background: #eee;
    }
  </style>
</head>
<body>
  <!-- 상단 -->
  <div class="top-bar">
    <div class="red-section">
      <div class="button-bar">
        <button onclick="location.href='success.html'">홈</button>
        <button onclick="location.href='write.html'">소설쓰기</button>
        <button onclick="logout()">로그아웃</button>
      </div>
    </div>
    <div class="yellow-section">
      내 소설 보기
    </div>
  </div>

  <!-- 내 소설 목록 -->
  <div class="content">
    <h2>내가 쓴 소설</h2>
    <div id="myNovelsBox">불러오는 중…</div>
  </div>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
    import { getAuth, signOut } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
    import { getFirestore, collection, query, where, orderBy, getDocs } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCr516GzQlQu6ev5K9GKwlE--6GWjPSjKw",
      authDomain: "novel-app-33aa7.firebaseapp.com",
      projectId: "novel-app-33aa7",
      storageBucket: "novel-app-33aa7.firebasestorage.app",
      messagingSenderId: "791233454587",
      appId: "1:791233454587:web:20319c91ca14d34bdc6b5e",
      measurementId: "G-BXT8Y97XW2"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // 로그아웃
    window.logout = async function(){
      await signOut(auth);
      alert("로그아웃 되었습니다.");
      location.href = "index.html";
    }

    // 내 소설 불러오기
    const box = document.getElementById("myNovelsBox");
    async function loadMyNovels(){
      box.innerHTML = "불러오는 중…";
      const user = auth.currentUser;
      if(!user){ box.innerHTML = "로그인이 필요합니다."; return; }
      try{
        const q = query(
          collection(db,"novels"),
          where("uid","==",user.uid),
          orderBy("createdAt","desc")
        );
        const snap = await getDocs(q);
        if(snap.empty){ box.innerHTML = "아직 작성한 소설이 없습니다."; return; }
        box.innerHTML = "";
        snap.forEach(d=>{
          const v = d.data();
          const btn = document.createElement("button");
          btn.className = "novel-button";
          btn.textContent = v.title || "(제목 없음)";
          btn.onclick = ()=> location.href = `detail.html?id=${d.id}`;
          box.appendChild(btn);
        });
      }catch(e){
        box.innerHTML = "불러오기 실패: " + e.message;
      }
    }

    auth.onAuthStateChanged(user=>{
      if(user) loadMyNovels();
      else box.innerHTML = "로그인이 필요합니다.";
    });
  </script>
</body>
</html>
